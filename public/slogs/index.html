<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>

@import url('https://fonts.googleapis.com/css2?family=Noto+Emoji&display=swap');

@font-face {
    font-family: 'msgfallback';
    src: url('../home/assets/MS\ PGothic.ttf');
}

body{
    background-color: white;
    color: black;
    font-family: 'MS PGothic', 'ＭＳ Pゴシック' , 'MS Pゴシック' , Mspgothic, 'msgfallback' , monospace, sans-serif,'Noto Emoji';
    font-size: 16px;
    font-smooth: never;
    -webkit-font-smoothing : none;
    image-rendering: pixelated;
}

a{
    color: black;
    text-decoration: underline;
}

hr{
    display: block;
    height: 1px;
    border: 0;
    border-top: 1px solid black;
    margin: 1em 0;
    padding: 0;
}

</style>

 
<!DOCTYPE html>
<html>
<head>
  <title>My Microblog</title>
</head>

<style>
  img{
    max-width: 100px;
    display: table-cell;
    vertical-align: middle;
  }
</style>

<body>
  <div id="microblog">Loading posts…</div>
  <p><a href="2024/"><- Older entries</a></p>

  <script>
    const sheetID = '19wuG_v-NYZ_1kYAdMCmiP-3YX0EXJ941jWo6kUhBYwk';  // Replace with your sheet ID
    const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json`;

    fetch(url)
      .then(res => res.text())
      .then(text => JSON.parse(text.substring(47).slice(0, -2)))
      .then(data => {
        const rows = data.table.rows
          .map(r => {
            const raw = r.c[0]?.v;
            const postText = r.c[1]?.v;
            if (!raw || !postText) return null;

            const match = raw.match(/Date\((\d+),(\d+),(\d+),(\d+),(\d+),(\d+)\)/);
            const date = match
              ? new Date(
                  Number(match[1]),
                  Number(match[2]),
                  Number(match[3]),
                  Number(match[4]),
                  Number(match[5]),
                  Number(match[6])
                )
              : new Date(raw);

            return { timestamp: date, post: postText };
          })
          .filter(Boolean)
          .sort((a, b) => b.timestamp - a.timestamp); // newest to oldest

        const container = document.getElementById('microblog');
        container.innerHTML = '';
        let lastDate = '';

        rows.forEach(({ timestamp, post }) => {
          const dayStr = timestamp.toDateString();

          if (dayStr !== lastDate) {
            if (lastDate) container.appendChild(document.createElement('hr'));
            lastDate = dayStr;
          }

          const p = document.createElement('p');
          p.innerHTML = `${post} - ${timestamp.toLocaleDateString()} ${timestamp.toLocaleTimeString()}`;
          container.appendChild(p);
        });
      })
      .catch(err => {
        document.getElementById('microblog').innerText = 'Failed to load posts.';
        console.error(err);
      });
  </script>
</body>
</html>

</html>